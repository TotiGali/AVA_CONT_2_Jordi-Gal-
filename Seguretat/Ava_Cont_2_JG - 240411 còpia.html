<!-- Autor:  Jordi Galí -->

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE-edge" />
  <title>AVA2_JG_FITNES_APP</title>
  <!--Enlazar los estilos CSS de Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <!-- Estils amb modificacions de detall sense enllaçar un arxiu CSS -->
  <style>
    .centrat, th, td, h5 {
    text-align: center;
    vertical-align: middle;
    color: black;
    border-radius: 4px;
    }
   /* No aconsegueixo que faci l'efecte de seleccionar la fila de la taula si tinc els estils de bootstrap.  Per això la tula entrenaments no te gaire disseny. */
    tr {
      background-color: rgb(255, 255, 255);
    }
    .table, .taula {
      border-collapse: separate; 
      border-spacing: 2px;
      width: 100%;
    }
    .instruction {
      font-style: italic;
      color: red;
      font-size: 24px;
      font-weight: bold;
    }
    #error-msg {
      font-style: italic;
      color: orange;
      font-size: 24px;
      font-weight: bold;
      display: none;
    }
    a {
      color: inherit; 
      text-decoration: none; 
    }
    a:visited {
      color: inherit; 
    }
    a:hover, a:focus {
      color: red; 
    }
    
  </style>

</head>

<body class="text-bg-secondary p-3">

  <!-- Aquesta és la barra de navegació :  PREGUTNA:  perquè no funciona el desplegable?-->

  <div> 
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#" style="color: orange;">INFITNES</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Inici</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" style="color: orange;" href="Ava_Cont_2_En contrucció_JG.html">Enllaç a pàgina en construcció</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Tipus de rutines
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Entrenaments</a></li>
                <li><a class="dropdown-item" href="#">Exercicis</a></li>  
              </ul>
            </li>
          </ul>
          <form class="d-flex" role="search">
            <input class="form-control me-2" type="search" placeholder="Escriu aquí" aria-label="Search">
            <button class="btn btn-outline-success" type="submit">Buscar</button>
          </form>
        </div>
      </div>
    </nav>
  </div>

  <!-- Aquest és el cos de la app -->
  <div>
    <br>
    <h1 class="centrat" style="color: orange;">LA TEVA APP D'ENTRENAMENT</h1>
    <hr>


    <!-- ENTRENAMENT NOU.  Aqui s'introdueixen les dades d'un nou entrenament 
    PREGUNTA:  Com fer que al clicar enter amb la dada de distáncia salti al botó?-->

    <h2>Introdueix un entrenament nou</h2>
    <p>Edita tu mateix les dades de l'entrenament que vols introduir</p>

    <div class="input-group mb-3">
      <span class="input-group-text">Introdueix el nom de la ruta<label for="nomruta"></label></span>
      <input type="text" class="form-control" aria-label="introduir el nom de la ruta" aria-describedby="input-nomruta-default" id="nomruta" name="nomruta" required aria-required="true" autocomplete="name" placeholder="Escriu aquí ent text el nom de la ruta. Aquest text s'esborrarà">
    </div> 
     
    <div class="input-group mb-3" id="entrenament_nou">
      <span class="input-group-text">Introdueix la distància<label for="distanciaruta"></label></span>
      <input type="text" class="form-control" aria-label="introduir la distancia de la ruta" aria-describedby="input-distanciaruta-default" id="distanciaruta" name="distanciaruta" required aria-required="true" autocomplete="name" placeholder="Escriu aquí la distància en xifres de la ruta. Aquest nombre s'esborrarà">
      <div id="error-msg">Compte! només s'admeten xifres ... </div>
    </div>

    <!-- Botó per afegir entrenament -->
    <p>Quan hagis afegit el nom i la distància de la ruta nova, fes click en el botó</p>
    <div>
      <button type="button" class="btn btn-warning d-flex" onclick="crearMatriu()">Clica aquí per afegir el teu entrenament</button>
    </div>
    <hr>

    <!-- TAULA D'ENTRENAMENTS -->
    <h2 id="taula_entrenaments">Taula d'entrenaments</h2>
    <p>Aquesta és la taula dels entrenaments</p>

    <div class="container-sm"> 

      <table class="taula" id="dataGrid">
        <thead class="table-light">
          <tr>
            <th style="width: 25%" scope="col">#</th>
            <th style="width: 25%" scope="col">Distància (KM)</th>
            <th style="width: 25%" scope="col">Pendent (%)</th>
            <th style="width: 25%" scope="col">OBJECIU</th>
          </tr>
        </thead>
       
        <tbody>
          <tr>
            <th scope="row">Ruta 1</th>
            <td>21</td>
            <td>6</td>
            <td>Temps 1h</td>
          </tr>
          <tr>
            <th scope="row">Ruta 2</th>
            <td>35</td>
            <td>12</td>
            <td>Temps 1h</td>
          </tr>
        </tbody>
        
      </table>
      <!-- 
      Faig una nova taula provisionalment a continuació de l'anterior amb les dades introduides de nous entrenaments -->
      <table class="taula" id="dataGridnova">
        <thead class="table-light">
          <tr>
            <th style="width: 25%" scope="col">#</th>
            <th style="width: 25%" scope="col">Nou</th>
            <th style="width: 25%" scope="col">Nou</th>
            <th style="width: 25%" scope="col">Nou</th>
          </tr>
        </thead>
       
        <tbody>
          <tr>
          <!-- Aqui van les dades noves introduides PREGUNTA:  com fer que surti en negreta el nom?-->
          </tr>
        </tbody>

      </table>
    </div>
    <br>

    <!-- Botó per eliminar entrenament -->
    <p>Si vols eliminar un dels entrenaments, fes click en el botó</p>
    <div>
      <button type="button" class="btn btn-warning d-flex" onclick="eliminarFila()">Clica aquí per eliminar l'entrenament seleccionat</button>
    </div>
  
    
    <!-- TAULA D'EXERCICIS -->
    <hr>
    <h2>Taula d'exercicis</h2>
    <p>Informació sobre els exercicis predefinits</p>

    <div class="container-sm"> 
      <table class="table" id="dataGrid">

        <!-- Encapçalaments -->
        <thead class="table-light">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Imatge</th>
            <th scope="col">Descripció</th>
            <th scope="col">Objectiu</th>
            <th scope="col">Video</th>
          </tr>
        </thead>

        <!-- Cos de la taula -->
        <tbody>

          <!-- fila flexions -->
          <tr>
            <th scope="row" id="flexions">FLEXIONS</th>
            <td href="#" onclick="mostrarTexto()">
              <img alt="imatge sobre com fer les flexions" src="Imatges/flexions.png" width="300" height="200">
              <!-- no aconsegueixo fer el filtre blanc i negre a la imatge que vindria a continuació amb canvas i per això he deixat l'enllaç normal img anterior-->
              <div>
                <!-- <canvas id="filtro-blanco-negro" width="300" height="200"></canvas> -->
              </div> 
              <br>
              <div id="textoDesplegable" style="display: none;">
                Per realitzar correctament les flexions primer cal respirar fons
              </div>
            </td>
            <td>Amb els braços a terra aixecar el cos</td>
            <td>Enfortir pectorals i braços</td>
            <td>
              <!-- Integraxió del primer video -->
              <div id="videoPlayerContainer"></div>
            </td>
          </tr>

          <!-- fila Pull ups -->
          <tr>
            <th scope="row" id="pullups" onclick="mostrarAlerta()">PULL UP</th>
            <td href="#" onclick="mostrarTexto2()">
              <img alt="imatge sobre com fer els pull up" src="Imatges/pulups.jpg" width="300" height="200">
              <br>
              <!-- idem cas anterior : -->
              <!-- <canvas id="filtro-blanco-negro-2" width="300" height="200"></canvas>  -->
              <div id="textoDesplegable2" style="display: none;">
                Per realitzar correctament el pull up, primer cal beure's un Seven Up
              </div>
            </td>
            <td>Agafat a la barra i puja tot el cos</td>
            <td>Enfortir dorsals</td>
            <td>
              <!-- Integració del segon video -->
              <div id="videoPlayerContainer2"></div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>


    <!-- EXECUCIÓ D'UN TENTRENAMENT -->
    <hr>
    <h2>Executa un entrenament</h2>
    <p>Escull un entrenament a la <a href="#taula_entrenaments" style="color:orange">taula d'entrenaments</a> i comença a cremar calories</p>

    <!-- Boton per iniciar i aturar entrenament i cronometre -->
    <div style="display: flex; flex-direction: column; align-items: center;">
      <div>
        <button type="button" class="btn btn-warning d-flex" onclick="iniciarCronometre()">Clica aquí per iniciar l'entrenament</button>
      </div>
      <br>
      <div id="cronometre" style="font-size: 120px;">00.00.0</div>
      <br>
      <div>
        <button type="button" class="btn btn-warning d-flex" onclick="detenirCronometre(); crearMatriuTemps();">Clica aquí per detenir l'entrenament</button>
      </div>
      <br>
    </div>
    <p>Quan facis click es registrarà el temps en la taula següent:</p>

    <table class="taula" id="MatriuTemps">
      <thead class="table-light">
        <tr>
          <th style="width: 75%" scope="col">Data entrenament</th>
          <th style="width: 25%" scope="col">Temps registrat</th>
        </tr>
      </thead>
     
      <tbody>
        <tr>
        <!-- Aqui van les dades noves introduides -->
        </tr>
      </tbody>

    </table>
    <br>
    <p>Quan hagis acabat l'entrenament recorda hidratar-te</p>

  </div>

<!-- Aqui va el footer -->
<hr>  
<h5>©️Infitnes 2029 | Tot el dret del món a entrenar | Sobirania entrenadora</h5>






<!-- AQUI VAN ELS SCRIPTS -->


<!-- Scripts per emplenar un ENTRENAMENT NOU -->

<script>
  const formInputs = document.querySelectorAll('input, textarea');   
    formInputs.forEach(input => {
    input.addEventListener('keyup', (event) => {
        if (event.key === 'Enter') {
            const index = Array.from(formInputs).indexOf(input);
            console.log("indice" + index);
            const nextIndex = index + 1;
            console.log("nextIndex" + nextIndex);
            if (nextIndex < formInputs.length) {
                formInputs[nextIndex].focus();
            }
        }
    });

    input.addEventListener('focus', (event) => {
        const instruction = document.createElement('div');
        instruction.classList.add('instruction');
        instruction.textContent = '... Presiona Enter per validar i passar';
        input.parentNode.appendChild(instruction);
    });
    
    // PREGUNTA:  perquè no valida després d'introduir distància i clicar enter?

    input.addEventListener('blur', (event) => {
        const instruction = input.parentNode.querySelector('.instruction');
        if (instruction) {
            instruction.remove();
        }
    });
});
</script>

<!-- gestió d'error = avis que només es poden introduir xifres en l'imput de distància -->
<script>
document.getElementById("distanciaruta").addEventListener("input", function(event) {
  var input = event.target.value;
  if (isNaN(input)) {
    document.getElementById("error-msg").style.display = "block";
  } else {
    document.getElementById("error-msg").style.display = "none";
  }
});
</script>


<!-- Script de Generació de l'array de nous entrenaments -->

<script>
  // Funció per crear la matriu i guardar-la en local
  function crearMatriu() {
    // Obtenir els valors dels camps d'entrada
    const nomRuta = document.getElementById('nomruta').value;
    const distanciaRuta = document.getElementById('distanciaruta').value;
    
    // Obtenir les dades previament guardades en local
    let storedMatriu = localStorage.getItem('matriu');
    let matriu = storedMatriu ? JSON.parse(storedMatriu) : [];

    // Agregar les noves dades
    matriu.push([nomRuta, distanciaRuta]);

    // Guardar la matriu actualitzada en local
    localStorage.setItem('matriu', JSON.stringify(matriu));

    // Mostra la matriu a la taula
    mostrarMatriu(matriu);
  }

  // Funció per mostrar la matriu a la taula
  function mostrarMatriu(matriu) {
    // Obtenir la referència de la taula
    const tableBody = document.querySelector('#dataGridnova tbody');

    // Netejar el contingut anterior
    tableBody.innerHTML = '';

    // Iterar sobre la matriu i agregar files
    matriu.forEach(element => {
      const row = tableBody.insertRow();
      for (const value of element) {
        const cell = row.insertCell();
        cell.textContent = value;
      }
    });

    // Imprimeix a la consola el resultat de la matriu
    console.log(matriu);
  }
</script>


<!-- TAULA ENTRENAMENTS -->

<!-- Script per la taula d'entrenaments: es realta en blau quan es selecciona un entrenament -->
<script>
  // <!-- Obtenir la taula -->
  var table = document.getElementById('dataGrid');

  // Obtenir les files de la taula
  var rows = table.getElementsByTagName('tr');

  // Iterar sobre les files i agregar un esdeveniment clic a cada una
  for (var i = 0; i < rows.length; i++) {
    rows[i].addEventListener('click', function() {
      // Resaltar la fila al fer clic en ella
      this.style.backgroundColor = 'lightblue';
      // Restableix el color de fons despres de 20 segons
      var row = this;
        setTimeout(function() {
          row.style.backgroundColor = '';
        }, 20000);
    });
  }
  // pregunta menor:  com fer que no sigui seleccionable els encapçalaments de la taula (el tr del head)?

  //PREGUNTA:  no funciona eliminar una fila de la taula
</script>

<!-- Script per eliminar entrenament -->
<script>
  // Función para eliminar una fila seleccionada de la tabla
  function eliminarFila() {
    // Obtener la tabla y las filas
    var table = document.getElementById("dataGrid");
    var rows = table.getElementsByTagName("tr");

    // Iterar sobre las filas
    for (var i = 0; i < rows.length; i++) {
      // Agregar un event listener de clic a cada fila
      rows[i].onclick = function() {
        // Obtener la fila actual
        var row = this.rowIndex;
        
        // Confirmar si el usuario desea eliminar la fila
        var respuesta = confirm("¿Estás segur que vols eliminar la fila seleccionada?");
        
        // Si el usuario confirma, eliminar la fila
        if (respuesta) {
          table.deleteRow(row);
        }
      };
    }
  }

  // Llamar a la función al cargar la página
  window.onload = function() {
    eliminarFila();
  };
</script>

<!-- TAULA D'EXERCICIS -->

<!-- Desplegable amb info més concreta per FLEXIONS-->
<script>
  // 1.creació de l'element
  const newElement = document.createElement('button');
  newElement.textContent = 'Per començar a fer flexions clica abaix';

  // 2. Afegir Event Listener
  newElement.addEventListener('click', () => {
    alert('Has clicat a Flexions! Comença l\'entrenament abaix');
  });
  
  // 3.Inserció en el DOM 
  const container = document.getElementById('flexions');  
  container.appendChild(newElement); 
 
  // 4.Actualització dinàmica 
  setTimeout(() => {
    newElement.textContent = 'Fes click Ara';
  }, 3000);

  //5.Manipulació del DOM
  setTimeout (() => {
    container.removeChild(newElement);
  }, 6000);
</script>

<!-- PREGUNTA:  no em realitza la modificació a blanc i negre -->

<!-- Script per la imatge de flexions perque surti en blanc i negre-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/camanjs/4.1.2/caman.full.min.js"></script>
<script>
  var img = new Image(); 
  img.onload = function() {
    Caman("#filtro-blanco-negro", function() {
      this.revert();
      this.resize({ width:300, height:200 });
      this.greyscale().render(); 
      });
    };
  img.src = "Imatges/flexions.png"
</script>

<!-- Script perquè apareixi un text i un alert en clicar sobre la paraula PULL UP -->
<script>
  pullups.addEventListener('click', () => {
    alert('Has clicat a PULL UP! Comença l\'entrenament abaix');
  });
</script>

<script>
  function mostrarAlerta() {
    alert("Per realitzar correctament els Pull UP, has de clicar sobre el video");
  }
</script>


<!-- Script perquè al clicar sobre la imatge de FLEXIONS apareixi i despareixi un text -->
<script>
    function mostrarTexto() {
    var texto = document.getElementById("textoDesplegable");
    if (texto.style.display === "none") {
      texto.style.display = "block";
      setTimeout(function() {
        texto.style.display = "none";
      }, 3000);
    } else {
      texto.style.display = "none";
    }
  }
</script>

<!-- Script perquè al clicar sobre la imatge de PULL UP apareixi i despareixi un text -->
<script>
  function mostrarTexto2() {
  var texto2 = document.getElementById("textoDesplegable2");
  if (texto2.style.display === "none") {
    texto2.style.display = "block";
    setTimeout(function() {
        texto2.style.display = "none";
      }, 3000);
  } else {
    texto2.style.display = "none";
  }
}
</script>

<!-- PREGUNTA: Tampoc surt en blanc i negre com el cas anterior de flexions -->
<!-- Script per la imatge de pullup perque surti en blanc i negre-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/camanjs/4.1.2/caman.full.min.js"></script>
<script>
  var img2 = new Image(); 
  img2.onload = function() {
    Caman("#filtro-blanco-negro-2", function() {
      this.revert();
      this.resize({ width:300, height:200 });
      this.greyscale().render(); 
      });
    };
  img2.src = "Imatges/pulup.jpg"
</script>

<!-- Script per el video de flexions -->
<script>
  // Integració amb Youtube
  const videoSource = "https://www.youtube.com/embed/SYPsuFlhVZs?si=k10GM1aFhp6x4-mJ";
  // Personalització de l'experiencia
  const videoPlayerContainer = document.getElementById('videoPlayerContainer');
  videoPlayerContainer.style.width ='560px';
  videoPlayerContainer.style.height ='315px';
  videoPlayerContainer.style.border ='1px solid #ccc';
  videoPlayerContainer.style.margin ='20px';
  // Crear el reproductor de vídeo
  const iframe = document.createElement('iframe');
  iframe.src = videoSource;
  iframe.width = '100%';
  iframe.height = '100%';
  iframe.title="YouTube video player" 
  iframe.frameborder="0"
  iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyrospoe; picture-in-picture';
  iframe.referrerpolicy="strict-origin-when-cross-origin"
  iframe.allowFullscreen = true;
  // Insertar el preproductor de video en el contenidor
  videoPlayerContainer.appendChild(iframe);
  // Seguiment i analisi de la reproducció del video
  trackVideoPlayback();
</script>

<!-- script per el video de pullup -->
<script>
  // Integració amb Youtube
  const videoSource2 = "https://www.youtube.com/embed/eGo4IYlbE5g?si=BxXurHivdanbrw6T";
  // Personalització de l'experiencia
  const videoPlayerContainer2 = document.getElementById('videoPlayerContainer2');
  videoPlayerContainer2.style.width ='560px';
  videoPlayerContainer2.style.height ='315px';
  videoPlayerContainer2.style.border ='1px solid #ccc';
  videoPlayerContainer2.style.margin ='20px';
  // Crear el reproductor de vídeo
  const iframe2 = document.createElement('iframe');
  iframe2.src = videoSource2;
  iframe2.width = '100%';
  iframe2.height = '100%';
  iframe2.title="YouTube video player2" 
  iframe2.frameborder="0"
  iframe2.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyrospoe; picture-in-picture';
  iframe2.referrerpolicy="strict-origin-when-cross-origin"
  iframe2.allowFullscreen = true;
  // Insertar el preproductor de video en el contenidor
  videoPlayerContainer2.appendChild(iframe2);
  // Seguiment i analisi de la reproducció del video
  trackVideoPlayback();
</script>

<!-- SCRIPT PER EXECUTAR UN ENTRENAMENT -->

<!-- Funció Cronometre -->
<script>
  let temps = 0;
  let interval;

  function iniciarCronometre() {
    temps = 0;
    // Detener el cronómetro si está en funcionamiento para evitar múltiples intervalos activos
    detenirCronometre();
    // Iniciar el cronómetro
    interval = setInterval(actualitzarCronometre, 10);
  }
  function detenirCronometre() {
    clearInterval(interval);
    interval = null;
  }
  function actualitzarCronometre() {
    temps += 10;
    const milisegundos = Math.floor(temps / 100) % 10;

    const segundos = Math.floor(temps / 1000) % 60;
    const minutos = Math.floor(temps / (1000 * 60)) % 60;

    const segundosString = String(segundos).padStart(2, '0');
    const minutosString = String(minutos).padStart(2, '0');

    document.getElementById('cronometre').textContent = `${minutosString}:${segundosString}.${milisegundos}`;
  }
</script>

<!-- Taula de registre dels temps | Funció crear matriu-->
<script>
  // Crear un nuevo objeto Date que contiene la fecha y hora actuales
  var fechaActual = new Date();

  // Obtener el año, mes y día por separado
  var año = fechaActual.getFullYear();
  var mes = fechaActual.getMonth() + 1; // Se suma 1 porque los meses comienzan desde 0
  var dia = fechaActual.getDate();

  // Formatear la fecha en el formato deseado (por ejemplo, YYYY-MM-DD)
  var fechaFormateada = año + '-' + (mes < 10 ? '0' : '') + mes + '-' + (dia < 10 ? '0' : '') + dia;

  // Imprimir la fecha formateada
  console.log(fechaFormateada);
</script>


<script>
  // Funció per crear la matriu i guardar-la en local
  function crearMatriuTemps() {
    // Obtenir els valors dels camps d'entrada
    const dataEntrenament = fechaFormateada;
    const tempsEntrenament = document.getElementById('cronometre').textContent;

    // Obtenir les dades previament guardades en local
    let storedMatriuTemps = localStorage.getItem('MatriuTemps');
    let MatriuTemps = storedMatriuTemps ? JSON.parse(storedMatriuTemps) : [];

    // Agregar les noves dades
    MatriuTemps.push([dataEntrenament, tempsEntrenament]);

    // Guardar la matriu actualitzada en local
    localStorage.setItem('MatriuTemps', JSON.stringify(MatriuTemps));

    // Mostra la matriu a la taula
    mostrarMatriuTemps(MatriuTemps);
  }

  // Funció per mostrar la matriu a la taula
  function mostrarMatriuTemps(MatriuTemps) {
    // Obtenir la referència de la taula
    const tableBodyTemps = document.querySelector('#MatriuTemps tbody');

    // Netejar el contingut anterior
    tableBodyTemps.innerHTML = '';

    // Iterar sobre la matriu i agregar files
    MatriuTemps.forEach(element => {
      const row = tableBodyTemps.insertRow();
      for (const value of element) {
        const cell = row.insertCell();
        cell.textContent = value;
      }
    });

    // Imprimeix a la consola el resultat de la matriu
    console.log(matriuTemps);
  }
</script>

</body>
</html>
